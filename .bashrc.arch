#
# ~/.bashrc
#

#
# Lazy Alias
#
alias ls='ls --color=auto'
alias ll="ls -la --color -h --group-directories-first"
alias restartnetwork="sudo systemctl restart systemd-networkd";
alias montar="sudo mount -av";
alias portslisting="sudo netstat -tulpn";
alias clipboard='xclip -sel clip'
alias negocionandossh='ssh root@45.55.140.124 -p 2297';
alias docker_ip="docker inspect --format '{{ .NetworkSettings.IPAddress }}'"

#
# Apps Alias
#
alias ip="./ip.sh";
alias hidemouse="nohup unclutter -display :0.0 -idle 3 &"

#
# Fix Alias
#
alias fixvagrant_inicialize="sudo modprobe vboxdrv";
alias fixnfs="systemctl start rpcbind.service && systemctl start nfs-server.service"
alias fixwatchcss="echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p";
alias fixdropbox="echo fs.inotify.max_user_watches=100000 | sudo tee -a /etc/sysctl.conf; sudo sysctl -p";
alias fixteclado="sudo setxkbmap -model abnt2 -layout br -variant abnt2";

#
# Pacman Alias
#
alias upgrade="yaourt -Syua"; 
alias remove="sudo pacman -Rs"
alias cleanpacman="pacman -Qtdq > /dev/null && sudo pacman -Rns \$(pacman -Qtdq | sed -e ':a;N;$!ba;s/\n/ /g')";
alias optimizepacman="sudo sudo pacman -Sc && sudo pacman-optimize && cleanpacman";
alias cleanmemory="sync && echo 3 | sudo tee /proc/sys/vm/drop_caches";

#
# Git alias
#
alias changesgit="git diff --name-status -r"
alias diffstatgit="git diff --stat -r"
alias whatis="git show -s --pretty='tformat:%h, %s, %ad' --date=short"
alias lg="git log --color --graph --pretty=format:'%Credbold%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"
alias listbranch="git branch -v"
alias status="git status"
alias commit="git commit"
alias add="git add"
alias changesgit="git diff --name-status -r"
alias rank="shortlog -sn --no-merges"
#Use it with the command. eg: git co
alias co="checkout"; # Checkout a branch
alias cob="checkout -b"; # Checkout a new not yet existing branch
alias cor="checkout -"; # Go back to the last branch
alias c="commit"; # Commit
alias ba="branch -a"; # List both remote-tracking branches and local branches.
alias bd="branch -d"; # Delete a branch only if it has been merged
alias dc="diff --cached"; # Display the staged changes
alias a="add -p"; # See the changes before adding

#
# Docker helper alias
#
alias edirectoryxcacheclean="docker exec -it edirectoryx2 /var/www/html/app/console cache:clear --no-warmup"
alias edirectoryxssh="docker exec -it edirectoryx2 bash"
alias edirectoryxperm="docker exec -it edirectoryx2 chown -R user:1000 /var/www/html"

#
# Update command others (python,node)
#
alias upgradeothers="sudo pip-review --local --interactive && npm-check -gu";

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# I dunno know...
PS1='[\u@\h \W]\$ '

# enable thefuck command. Funny command
eval "$(thefuck --alias fuck)"

#
# Powerline
#
if [ -f /usr/lib/python3.5/site-packages/powerline/bindings/bash/powerline.sh ]; then
    source /usr/lib/python3.5/site-packages/powerline/bindings/bash/powerline.sh
fi

# workaround
fixinicial() {
    # layout teclado
	sudo setxkbmap -model abnt2 -layout br -variant abnt2
    # habilitar virtualização
	sudo modprobe vboxdrv
    # montar servidores arca
	sudo mount -av
    # habilitar ip interno fixo
    sudo modprobe vboxnetflt
    # erro de gui, não estava iniciando, resolvido após rodar isso
    sudo modprobe vboxnetadp
}

# workaround
fixvagrant() {
    # habilitar virtualização
	sudo modprobe vboxdrv
    # habilitar ip interno fixo
    sudo modprobe vboxnetflt
    # erro de gui, não estava iniciando, resolvido após rodar isso
    sudo modprobe vboxnetadp
}

updatecontaineredirectoryx() {
    # gets container IP
    IP=$(docker inspect --format '{{ .NetworkSettings.IPAddress }}' edirectoryx2)
    # gets older IP saved in a file
    OLD_IP=$(cat ~/old_ip_edirectoryx)
    # changes IPs in hosts file
    sudo sed -i -e "s/$OLD_IP/$IP/g" /etc/hosts
    # copy new IP to file
    echo $IP > ~/old_ip_edirectoryx
}

updatecontainerdb() {
    # gets container IP
    IP=$(docker inspect --format '{{ .NetworkSettings.IPAddress }}' db)
    # gets older IP saved in a file
    OLD_IP=$(cat ~/old_ip_db)
    # changes IPs in hosts file
    sudo sed -i -e "s/$OLD_IP/$IP/g" /etc/hosts
    # copy new IP to file
    echo $IP > ~/old_ip_db
}

updateallcontainers() {
    # updates IPs from projects
    updatecontainerdb && updatecontaineredirectoryx    
}

# explain commands
explain () {
  if [ "$#" -eq 0 ]; then
    while read  -p "Command: " cmd; do
      curl -Gs "https://www.mankier.com/api/explain/?cols="$(tput cols) --data-urlencode "q=$cmd"
    done
    echo "Bye!"
  elif [ "$#" -eq 1 ]; then
    curl -Gs "https://www.mankier.com/api/explain/?cols="$(tput cols) --data-urlencode "q=$1"
  else
    echo "Usage"
    echo "explain                  interactive mode."
    echo "explain 'cmd -o | ...'   one quoted command to explain it."
  fi
}


#
# Export Functions
#
export -f fixinicial
export -f fixvagrant
export -f updatecontaineredirectoryx
export -f updatecontainerdb
export -f updateallcontainers
export -f explain

#
# Export PATH
#
export PATH=/home/faustino/.gem/ruby/2.2.0/bin:$PATH
#export python=/usr/bin/python2
export PATH=~/bin:$PATH
export DOCKER_OPTS="-dns 8.8.8.8 -dns 8.8.4.4"

if [ -d "$HOME/opt/node-webkit" ]; then
    PATH="$PATH:$HOME/opt/node-webkit"
fi


bind Space:magic-space
